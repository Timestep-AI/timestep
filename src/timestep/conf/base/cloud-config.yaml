#cloud-config
# See documentation for more configuration examples
# https://cloudinit.readthedocs.io/en/latest/reference/examples.html
---
disable_root: true
package_reboot_if_required: true
package_update: true
package_upgrade: true
packages:
  - build-essential
  - curl
  - default-jdk
  - direnv
  - figlet
  - jq
  - libbz2-dev
  - libffi-dev
  - liblzma-dev
  - libncursesw5-dev
  - libreadline-dev
  - libsqlite3-dev
  - libssl-dev
  - libxml2-dev
  - libxmlsec1-dev
  - net-tools
  - tk-dev
  - unzip
  - xz-utils
  - zlib1g-dev
runcmd:
  -  # Installing and configuring Oh My Bash...
  - runuser -l ubuntu -c 'bash -c "$(curl -fsSL https://raw.githubusercontent.com/ohmybash/oh-my-bash/master/tools/install.sh)"'
  - runuser -l ubuntu -c 'echo "" >> $HOME/.oh-my-bash/custom/example.sh'
  - runuser -l ubuntu -c 'echo OSH_THEME=\"zork\" >> $HOME/.oh-my-bash/custom/example.sh'
  -  # Installing anyenv and **envs...
  - runuser -l ubuntu -c 'git clone https://github.com/anyenv/anyenv ~/.anyenv'
  - runuser -l ubuntu -c 'echo "" >> $HOME/.bashrc'
  - runuser -l ubuntu -c 'echo export PATH=\$HOME/.anyenv/bin:\$PATH >> $HOME/.bashrc'
  - runuser -l ubuntu -c 'echo "eval \"\$(anyenv init -)\"" >> $HOME/.bashrc'
  - runuser -l ubuntu -c '$HOME/.anyenv/bin/anyenv install --force-init'
  - runuser -l ubuntu -c '$HOME/.anyenv/bin/anyenv install jenv'
  - runuser -l ubuntu -c '$HOME/.anyenv/bin/anyenv install nodenv'
  - runuser -l ubuntu -c '$HOME/.anyenv/bin/anyenv install goenv'
  - runuser -l ubuntu -c '$HOME/.anyenv/bin/anyenv install pyenv'
  -  # Configuring direnv bash hook...
  - runuser -l ubuntu -c 'echo "eval \"\$(direnv hook bash)\"" >> $HOME/.bashrc'
  -  # Creating app directory...
  - runuser -l ubuntu -c 'mkdir $HOME/app'
users:
  - default
  - groups: sudo
    name: ubuntu
    shell: /bin/bash
    ssh_authorized_keys:
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDVgVnkgU82DyHzqW2feq47srn3PYaXefRrfzbEpZPGMkCAUAHUH+icWjmcZRLNBtG1OjhLFmPxpW/TU00Mbouxp7PlUa1vwLrsi7XcxLt2UbvV6ueXiXK4HLHgLCqW0prG5mhrGX7XX6UfSfmt+lIDxZZoPtVzr8PGFFDIY+BmqOxJL+h8HkO5N/Hm8Q70voMWhOhtXNIcnF4WOakFlK9t5pEuXp7HzVZPtP3NYUO9fPSEVcoMvyXpzWlFBmdauGtDuyp71mwk4Jc0dWcxlKskRHGiwwxaZXU8fsqFwpIoPpM95xUHC3YRFqYsHI5hi4RbmKoIb32uPP2hIIQoL/1oVWSQuQpj5JIimNziQGPh5eySbbWuhwXiqK4VdgMIcw6gE79GgSu4Rds9DYdK2EcsuZbpMUnYtU3jWAY3ad43D+Y5aSHFf6QEvAjW8GxCftlRrGTjo5YiG7+GYA9ewNI1KGRW1h+Wu3A7MMiBFtyEIGnCrB6QdKY1XyU7DTPNKY0= m@mjschock.com
    sudo: ALL=(ALL) NOPASSWD:ALL
write_files:
  - content: |
      #!/bin/sh
      [ -r /etc/lsb-release ] && . /etc/lsb-release

      if [ -z "$DISTRIB_DESCRIPTION" ] && [ -x /usr/bin/lsb_release ]; then
            # Fall back to using the very slow lsb_release utility
            DISTRIB_DESCRIPTION=$(lsb_release -s -d)
      fi

      printf "Welcome to \n%s\nv%s\nrunning on %s (%s %s %s).\n" "$(figlet Timestep AI)" "$(date +'%Y.%m.%d')" "$DISTRIB_DESCRIPTION" "$(uname -o)" "$(uname -r)" "$(uname -m)"
    path: /etc/update-motd.d/00-header
    permissions: "0755"
  - content: |
      mirrors:
        registry.localhost:
          endpoint:
            - "http://registry:5000"
    path: /etc/rancher/k3s/registries.yaml
    permissions: "0644"
