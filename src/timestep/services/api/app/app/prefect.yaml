# Generic metadata about this project
name: app
prefect-version: 2.13.7

# # build section allows you to manage and build docker images
# build:
# - prefect.deployments.steps.run_shell_script:
#     id: get-commit-hash
#     script: git rev-parse --short HEAD
#     stream_output: false
# - prefect_docker.deployments.steps.build_docker_image:
#     id: build-image
#     requires: prefect-docker>=0.4.0
#     image_name: "{{ $PREFECT_IMAGE_NAME }}"
#     tag: "{{ get-commit-hash.stdout }}"
#     dockerfile: auto
#     platform: "linux/amd64"
#     # push: false

# # push section allows you to manage if and how this project is uploaded to remote locations
# push:
# - prefect_docker.deployments.steps.push_docker_image:
#     requires: prefect-docker>=0.4.0
#     image_name: "{{ build-image.image_name }}"
#     tag: "{{ build-image.tag }}"

# # pull section allows you to provide instructions for cloning this project in remote locations
# pull:
# - prefect.deployments.steps.set_working_directory:
#     directory: /opt/prefect/flows

# build section allows you to manage and build docker images
build: null

# push section allows you to manage if and how this project is uploaded to remote locations
push: null

# pull section allows you to provide instructions for cloning this project in remote locations
pull:
- prefect.deployments.steps.set_working_directory:
    # directory: /home/mjschock/Projects/timestep-ai/timestep/src/timestep/services/api/app/app
    directory: /app/app

# the definitions section allows you to define reusable components for your deployments
definitions:
  tags: &common_tags
    - "k3s"
    # - "{{ get-commit-hash.stdout }}"
  work_pool: &common_work_pool
    name: "default-worker-pool"
    work_queue_name: default
    job_variables:
      # command: "tail -f /dev/null"
      # command: "poetry run python hello.py"
      # command: "pwd && ls -al && python --version"
      command: "/usr/local/bin/poetry run python -m prefect.engine"
      image: "{{ $DOCKER_IMAGE_REF }}"
      # image_pull_policy: 'Never'

# the deployments section allows you to provide configuration for deploying flows
deployments:
- name: "default"
  tags: *common_tags
  schedule: null
  entrypoint: "flows/hello.py:hello"
  work_pool: *common_work_pool

- name: "arthur"
  tags: *common_tags
  schedule: null
  entrypoint: "flows/hello.py:hello"
  parameters:
    name: "Arthur"
  work_pool: *common_work_pool
